# プロダクト要求定義書

## プロダクトビジョンと目的

GROWI の Wiki ページにおける添付ファイル管理を改善するプラグインを開発する。
現状、GROWI の閲覧ページでは添付ファイルの一覧確認や情報取得に手間がかかるため、
モーダルUIで添付ファイル情報を一覧表示し、必要な情報を素早くコピーできる機能を提供する。

## ターゲットユーザーと課題・ニーズ

### ターゲットユーザー

- GROWI を使用するチームの Wiki 管理者
- GROWI でドキュメント作成・編集を行うコンテンツ作成者
- 添付ファイルへのリンクを頻繁に利用するユーザー

### 課題

- 添付ファイルのファイルIDや直接URLを確認するのが困難
- Markdown 形式でのリンク挿入時に、手動でリンクを構築する必要がある
- 画像ファイルの場合、サイズ（寸法・容量）を確認するためにダウンロードが必要
- 複数の添付ファイルがある場合、ファイル名と内容の対応を把握しにくい

### ニーズ

- 添付ファイルの一覧を素早く確認したい
- ファイルの各種情報（ID、サイズ、URL）をワンクリックでコピーしたい
- Markdown 記法のリンクを自動生成してほしい
- 画像の場合は寸法情報も確認したい
- ページの全添付ファイルを一括でダウンロードしたい

## 主要な機能一覧

1. **添付ファイル一覧表示（テーブル形式）**
   - 閲覧中のページに紐づく添付ファイルを取得して一覧表示
   - テーブル形式でファイル情報を整理して表示

2. **ファイル情報の表示**
   - ファイル名
   - ファイルID
   - ファイルサイズ（容量）
   - 画像ファイルの場合：画像の寸法（幅 × 高さ）

3. **コピー機能**
   - ファイル名のコピー
   - ファイルIDのコピー
   - Markdown 形式リンクのコピー（`![alt](url)` または `[name](url)`）
   - 直接URLのコピー

4. **一括ダウンロード機能**
   - モーダル内のボタンから全添付ファイルを一括ダウンロード
   - ダウンロード時のファイル名は `{ファイル名}-{ファイルID}.{拡張子}` 形式に変換

5. **モーダル表示**
   - ページ閲覧中に任意のタイミングで表示可能
   - GROWI の UI に馴染むデザイン

## 成功の定義

- ユーザーが添付ファイルの情報を 3 クリック以内で取得できる
- Markdown リンクをワンクリックでクリップボードにコピーできる
- 画像の寸法情報がモーダル内で確認できる
- 全添付ファイルをワンクリックで一括ダウンロードできる
- GROWI の既存 UI と違和感なく統合されている

## ビジネス要件

- GROWI のプラグインシステムに準拠して実装する
- OSS として公開可能なライセンス（MIT）で提供する
- GROWI のバージョンアップに追従しやすい設計とする

## ユーザーストーリー

1. **As a** コンテンツ作成者、**I want to** 添付ファイルの一覧をモーダルで確認したい、**so that** ページの添付状況を素早く把握できる

2. **As a** コンテンツ作成者、**I want to** 画像の Markdown リンクをワンクリックでコピーしたい、**so that** 別のページに画像を貼り付ける作業を効率化できる

3. **As a** コンテンツ作成者、**I want to** ファイルの直接 URL をコピーしたい、**so that** 他のツールからファイルを参照できる

4. **As a** Wiki 管理者、**I want to** ファイルIDを確認したい、**so that** ファイル管理や API 操作に利用できる

5. **As a** コンテンツ作成者、**I want to** 全添付ファイルを一括でダウンロードしたい、**so that** ページの添付ファイルをまとめてローカルに保存できる

## 受け入れ条件

- [ ] GROWI の閲覧ページにプラグインが表示される
- [ ] テーブルにファイル名・ファイルID・サイズが表示される
- [ ] 画像ファイルには寸法（幅×高さ）が表示される
- [ ] 各ファイルの Markdown リンクがコピーできる
- [ ] 各ファイルの直接 URL がコピーできる
- [ ] コピー成功時にフィードバック（トースト通知等）が表示される
- [ ] 一括ダウンロードボタンから全添付ファイルをダウンロードできる
- [ ] ダウンロードされるファイル名が `{ファイル名}-{ファイルID}.{拡張子}` 形式になっている

## 機能要件

### FR-001: 添付ファイル一覧取得

- GROWI の API を使用して現在閲覧中のページの添付ファイル一覧を取得する
- ページ ID を使用してフィルタリングする

### FR-002: テーブル表示

| カラム | 内容 | 備考 |
|--------|------|------|
| ファイル名 | 元のファイル名 | |
| ファイルID | GROWI 内部のファイル識別子 | |
| サイズ | ファイル容量（KB/MB表示） | |
| 寸法 | 画像の幅 × 高さ | 画像ファイルのみ |
| リンク（Markdown） | `![name](url)` または `[name](url)` | コピーボタン付き |
| URL | ファイルの直接アクセス URL | コピーボタン付き |

### FR-003: コピー機能

- クリップボード API を使用してコピーを実装
- コピー成功時にビジュアルフィードバックを提供

### FR-004: 一括ダウンロード機能

- モーダル内に「全てダウンロード」ボタンを設置する
- 各ファイルを順次ダウンロードする
- ダウンロード時のファイル名は以下の形式に変換する：
  - 形式: `{元のファイル名（拡張子なし）}-{ファイルID}.{拡張子}`
  - 例: `screenshot-abc123def456.png`

### FR-005: モーダル表示

- ページ閲覧時に固定ボタンまたは既存 UI 要素からモーダルを開く
- モーダルはオーバーレイ表示とする

## 非機能要件

- **パフォーマンス**: 添付ファイル一覧の取得は 2 秒以内に完了する
- **ブラウザ互換性**: Chrome、Firefox、Edge の最新版をサポート
- **アクセシビリティ**: キーボードナビゲーション対応
- **多言語対応**: GROWI の i18n 機能に準拠（日本語・英語）
